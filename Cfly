if game.CoreGui:FindFirstChild("Tiki_Menu_TGI_CFLY") then
	game.CoreGui.Tiki_Menu_TGI_CFLY:Destroy()
end

local RunService, Players = game:GetService("RunService"), game:GetService("Players")
local player, CFspeed, CFloop = Players.LocalPlayer, 50, nil

local function startHeadMove()
	local character = player.Character
	local humanoid = character and character:FindFirstChildOfClass("Humanoid")
	local head = character and character:FindFirstChild("Head")
	if not (humanoid and head) then return end

	humanoid.PlatformStand = true
	head.Anchored = true

	if CFloop then CFloop:Disconnect() end
	CFloop = RunService.Heartbeat:Connect(function(dt)
		local move = humanoid.MoveDirection * (CFspeed * dt)
		local camCF, headCF = workspace.CurrentCamera.CFrame, head.CFrame
		local relPos = headCF:ToObjectSpace(camCF).Position
		local camOffset = camCF * CFrame.new(-relPos.X, -relPos.Y, -relPos.Z + 1)
		local lookCF = CFrame.new(camOffset.Position, Vector3.new(headCF.X, camOffset.Y, headCF.Z))
		local velocity = lookCF:VectorToObjectSpace(move)

		head.CFrame = CFrame.new(head.Position) * (camOffset - camOffset.Position) * CFrame.new(velocity)
	end)
end

local function stopHeadMove()
	if CFloop then CFloop:Disconnect(); CFloop = nil end
	local char, head = player.Character, player.Character and player.Character:FindFirstChild("Head")
	local humanoid = char and char:FindFirstChildOfClass("Humanoid")
	if humanoid then humanoid.PlatformStand = false end
	if head then head.Anchored = false end
end

-- UI
local function createUIElement(class, props, parent)
	local obj = Instance.new(class)
	for k, v in pairs(props) do obj[k] = v end
	if parent then obj.Parent = parent end
	return obj
end

local gui = createUIElement("ScreenGui", {
	Name = "Tiki_Menu_TGI_CFLY",
	ResetOnSpawn = false,
	Parent = game.CoreGui
})

local main = createUIElement("Frame", {
	Size = UDim2.new(0, 200, 0, 120),
	Position = UDim2.new(0.5, -100, 0.5, -60),
	BackgroundColor3 = Color3.fromRGB(25, 25, 25),
	Active = true,
	Draggable = true,
	Parent = gui
})
createUIElement("UICorner", {}, main)

local title = createUIElement("TextLabel", {
	Size = UDim2.new(1, 0, 0, 25),
	Text = " CFly",
	Font = Enum.Font.SourceSansBold,
	TextSize = 20,
	TextColor3 = Color3.new(1, 1, 1),
	BackgroundTransparency = 1,
	Parent = main
})

local control = createUIElement("Frame", {
	Size = UDim2.new(0.9, 0, 0, 30),
	Position = UDim2.new(0.05, 0, 0, 35),
	BackgroundColor3 = Color3.fromRGB(35, 35, 35),
	Parent = main
})
createUIElement("UICorner", {}, control)

local textBox = createUIElement("TextBox", {
	Size = UDim2.new(0.4, -2, 1, 0),
	BackgroundColor3 = Color3.fromRGB(45, 45, 45),
	Text = tostring(CFspeed),
	Font = Enum.Font.SourceSans,
	TextSize = 16,
	TextColor3 = Color3.new(1, 1, 1),
	ClearTextOnFocus = false,
	Parent = control
})
createUIElement("UICorner", {}, textBox)

local minus = createUIElement("TextButton", {
	Size = UDim2.new(0.3, -2, 1, 0),
	Position = UDim2.new(0.4, 2, 0, 0),
	BackgroundColor3 = Color3.fromRGB(45, 45, 45),
	Text = "-",
	Font = Enum.Font.SourceSansBold,
	TextSize = 16,
	TextColor3 = Color3.new(1, 1, 1),
	Parent = control
})
createUIElement("UICorner", {}, minus)

local plus = createUIElement("TextButton", {
	Size = UDim2.new(0.3, -2, 1, 0),
	Position = UDim2.new(0.7, 2, 0, 0),
	BackgroundColor3 = Color3.fromRGB(45, 45, 45),
	Text = "+",
	Font = Enum.Font.SourceSansBold,
	TextSize = 16,
	TextColor3 = Color3.new(1, 1, 1),
	Parent = control
})
createUIElement("UICorner", {}, plus)

local flyButton = createUIElement("TextButton", {
	Size = UDim2.new(0.9, 0, 0, 30),
	Position = UDim2.new(0.05, 0, 1, -35),
	BackgroundColor3 = Color3.fromRGB(40, 40, 40),
	Text = " FLY",
	Font = Enum.Font.SourceSansBold,
	TextSize = 18,
	TextColor3 = Color3.fromRGB(255, 255, 255),
	Parent = main
})
createUIElement("UICorner", {}, flyButton)

-- Funções da UI
local function updateTextbox()
	textBox.Text = tostring(CFspeed)
end

plus.MouseButton1Click:Connect(function()
	CFspeed += 10
	updateTextbox()
end)

minus.MouseButton1Click:Connect(function()
	CFspeed = math.max(10, CFspeed - 10)
	updateTextbox()
end)

textBox.FocusLost:Connect(function()
	local val = tonumber(textBox.Text)
	if val then CFspeed = math.clamp(val, 10, 500) end
	updateTextbox()
end)

local active = false
flyButton.MouseButton1Click:Connect(function()
	active = not active
	if active then
		startHeadMove()
		flyButton.Text = " PARAR"
	else
		stopHeadMove()
		flyButton.Text = " FLY"
	end
end)

player.CharacterAdded:Connect(function()
	stopHeadMove()
	active = false
	flyButton.Text = " FLY"
end)
